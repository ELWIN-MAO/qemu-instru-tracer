                                                     指令频度统计使用和帮助文档
一、服务器端部署                                                         
1.制作虚拟磁盘并安装系统
  由于qemu从一个空的虚拟磁盘开始安装系统十分缓慢，没法接受，所以选择用vmware虚拟机安装操作系统，生成lubuntu12.04.vmdk这样的虚拟磁盘。
2.将*.vmdk上传到124.16.141.162服务器
myming@ubuntu-xyong:~$ pwd
/home/myming

myming@ubuntu-xyong:~$ ls lubuntu_10.17/
lubuntu12.04.vmdk

3. 
cd /home/myming
git clone https://github.com/xyongcn/qemu-instru-tracer

cd ./qemu-instru-tracer
./configure --target-list=i386-softmmu --prefix=/usr/local/qemu_mym  && make && make install
会安装QEMU到/usr/loacl/qemu_mym/目录下面

myming@ubuntu-xyong:~$ pwd
/home/myming

运行/usr/loacl/qemu_mym/qemu-system-i386   -hda  ./lubuntu_10.17/lubuntu12.04.vmdk   -boot c  -m 2048   -k en-us  -d exec,in_asm -D ./log-zml.txt
这样的命令即可以使用vmdk虚拟机。

3. 转换vmdk到raw格式
由于vmdk格式的虚拟磁盘不能直接在host中挂载读写，所以需要将vmdk转换为raw格式。
cd /home/myming/lubuntu_10.17

/usr/loacl/qemu_mym/qemu-img convert -f vmdk -O raw  lubuntu12.04.vmdk lubuntu12.04.raw

4.使用raw格式的磁盘
cd /home/myming
/usr/loacl/qemu_mym/qemu-system-i386   -hda  ./lubuntu_10.17/lubuntu12.04.raw   -boot c  -m 2048   -k en-us  -d exec,in_asm -D ./log-zml.txt
 
5.挂载读写raw格式的磁盘

5.1
cd /home/myming/lubuntu_10.17

fdisk  -l lubuntu12.04.raw

Disk lubuntu12.04.raw: 85.9 GB, 85899345920 bytes
255 heads, 63 sectors/track, 10443 cylinders, total 167772160 sectors
Units = 扇区 of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00004456

           设备 启动      起点          终点     块数   Id  系统
lubuntu12.04.raw1   *        2048   136718335    68358144   83  Linux
lubuntu12.04.raw2       136720382   152342527     7811073    5  扩展
lubuntu12.04.raw5       136720384   152342527     7811072   82  Linux 交换 / Solaris

算出第1个主分区的offset=2048*512=1048576
算出第2个扩展分区的offset=136720382*512             扩展分区没法挂载
扩展分区里面的第一个逻辑分区的offset=136720384*512  第一个逻辑分区是swap分区，也没有挂载意义。
其他分区的offset计算方法类似。


5.2
挂载第一个主分区。
cd /home/myming
mkdir rawmount
mount -o loop,offset=1048576   ./lubuntu_10.17/lubuntu12.04.raw  ./rawmount
cd rawmount下面即可以对第一个主分区中的内容进行读写操作。
操作完毕后离开挂载点并umount rawmount



6.lubuntu图形界面下自动登录特定账户
启动lubuntu
cd /home/myming

/usr/loacl/qemu_mym/qemu-system-i386   -hda  ./lubuntu_10.17/lubuntu12.04.raw   -boot c  -m 2048   -k en-us

6.1
以root账号登陆lubuntu
修改
/etc/lxdm/default.conf   
autologin=root #要登录的用户名 


6.2
修改
/etc/lightdm/lightdm.conf  
[SeatDefaults]  
autologin-user=root #要登录的用户名 
autologin-user-timeout=0  
greeter-session=lightdm-gtk-greeter  
user-session=Lubuntu  


7.lubuntu图形界面下，系统登录后自动执行程序

mkdir -p ~/.config/lxsession/Lubuntu/           

touch ~/.config/lxsession/Lubuntu/autostart 

编辑autostart
@/root/new/aaa.sh



其中@后面是要自动执行的脚本或者命令


/root/new/aaa.sh
内容如下：
#!/bin/bash
echo "start" > /root/new/bbb.txt                         
date >> /root/new/bbb.txt   
sleep 10
/usr/local/runScript -r /root/Documents/test.sikuli/     #执行skuli                         
echo "stop" >> /root/new/bbb.txt
shutdown -h now                                      #自动关机    



8.
使用root账号登陆服务器
cd /home/myming


myming@ubuntu-xyong:~$ pwd
/home/myming


myming@ubuntu-xyong:~$ ls
qemu-instru-tracer

9.
ln -s  qemu-instru-tracer/deploy_help_doc/all_work_flow/   git_tijiao


myming@ubuntu-xyong:~$ cd git_tijiao/all_work_flow/

myming@ubuntu-xyong:~/git_tijiao/all_work_flow$ pwd
/home/myming/git_tijiao/all_work_flow

ln -s /home/mying/lubuntu_10.17/  lubuntu


10.
cd /home/myming/git_tijiao/all_work_flow/prog

运行./test_init.sh初始化环境（只需要运行一次）
./test_clean.sh清空上次的测试用例和测试结果

#==========================
#3.
#将测试用例xxxx.tar.gz拷贝到test_case目录中
#
#4.
#./start_all.sh 自动处理所有流程
#
#5.
#生成结果存放在./test_case目录当中。
#
#
#中途如果想停止
#./v_kill.sh 关掉所有的程序
#./v_clean.sh 清理中间结果，以及最后结果，只保留程序代码。
#==========================================
至此124.16.141.162机器上的指令频度的部署已经完成。


二、web服务器端部署
1.
将/home/myming/qemu-instru-tracer/deploy_help_doc/web_test_prog/remote.sh
拷贝到
124.16.141.184机器上的/home/myming/目录下。

2.
配置web服务器（124.16.141.184）和运行QEMU的服务器（124.16.141.184）可以相互无密码ssh root登录。


三、开始测试
1.
在浏览器中输入以下地址
http://124.16.141.184/lxr/import

2.
选择
version：linux-3.5.4  paltform:x86_32  testcase directory:testcase2 
单击change按钮
选择文件：
这里有一个准备好的测试用例（测试用例的制作方法见sikuli使用文档）
/home/myming/qemu-instru-tracer/deploy_help_doc/all_work_flow/test-music.sikuli.tar.gz
单击UploadFlie
文件上传成功后
单击Excute Test Script按钮即可执行测试用例。

3.
测试完成后web浏览器会显示测试结果。